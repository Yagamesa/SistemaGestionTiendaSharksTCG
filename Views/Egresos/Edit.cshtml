@model ProyectoMDGSharksWeb.Models.Egreso

@{
    ViewBag.Title = "Editar Egreso";
}

<h1>Editar Egreso</h1>

<form asp-action="Edit" method="post">
    <input type="hidden" asp-for="Id" />
    <div>
        <label>Tipo de Egreso</label>
        <input type="hidden" id="IdTipoEgreso" name="IdTipoEgreso" value="@Model.IdTipoEgreso" />
        <input type="text" id="buscarTipoEgreso" value="@Model.IdTipoEgresoNavigation?.Nombre" placeholder="Buscar tipo de egreso..." class="input-text" autocomplete="off" />
        <div id="sugerenciasTipoEgreso" class="sugerencias"></div>
        <br />
        <a href="@Url.Action("CreateTipo", "Egresos")" target="_blank" class="btn-nuevo">+ Nuevo Tipo de Egreso</a>
    </div>

    <div>
        <label>Monto</label>
        <input asp-for="Monto" type="number" step="0.01" required />
    </div>

    <div>
        <label>Fecha</label>
        <input asp-for="Fecha" type="date" required />
    </div>

    <div>
        <label>Descripción</label>
        <textarea asp-for="Descripcion" rows="3"></textarea>
    </div>

    <input type="hidden" name="IdUsuario" value="@ViewBag.IdUsuario" />

    <button type="submit" class="btn-nuevo">Guardar Cambios</button>
    <a asp-action="Index" class="btn-limpiar">Cancelar</a>
</form>

@section Scripts {
    <script>
        const buscarInput = document.getElementById('buscarTipoEgreso');
        const sugerenciasDiv = document.getElementById('sugerenciasTipoEgreso');
        const idTipoInput = document.getElementById('IdTipoEgreso');

        buscarInput.addEventListener('input', () => {
            const term = buscarInput.value;
            if (term.length === 0) {
                sugerenciasDiv.innerHTML = '';
                return;
            }

            fetch(`@Url.Action("BuscarTipoEgreso", "Egresos")?term=${encodeURIComponent(term)}`)
                .then(res => res.json())
                .then(data => {
                    sugerenciasDiv.innerHTML = '';
                    data.forEach(item => {
                        const div = document.createElement('div');
                        div.textContent = item.nombre;
                        div.classList.add('sugerencia');
                        div.addEventListener('click', () => {
                            buscarInput.value = item.nombre;
                            idTipoInput.value = item.id;
                            sugerenciasDiv.innerHTML = '';
                        });
                        sugerenciasDiv.appendChild(div);
                    });
                });
        });
    </script>
}

<style>
    h1 {
        font-weight: bold;
        color: #001f3f;
        margin-bottom: 20px;
    }

    label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    textarea {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        margin-bottom: 15px;
    }

    .btn-nuevo {
        background-color: #28a745;
        color: white;
        padding: 10px 16px;
        text-decoration: none;
        font-weight: bold;
        border-radius: 5px;
        display: inline-block;
    }

        .btn-nuevo:hover {
            background-color: #218838;
        }

    .btn-limpiar {
        background-color: darkred;
        color: white;
        padding: 10px 16px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
    }

        .btn-limpiar:hover {
            background-color: #a50000;
        }

    .sugerencias {
        border: 1px solid #ccc;
        background: white;
        max-height: 150px;
        overflow-y: auto;
        border-radius: 4px;
    }

    .sugerencia {
        padding: 8px;
        cursor: pointer;
    }

        .sugerencia:hover {
            background-color: #e9ecef;
        }
</style>
